#!/bin/sh
# Pre-commit hook para otimizar GIFs automaticamente

# Verificar se hÃ¡ GIFs staged
STAGED_GIFS=$(git diff --cached --name-only --diff-filter=ACM | grep -i "\.gif$")

if [ -z "$STAGED_GIFS" ]; then
    exit 0
fi

echo "GIFs detectados, otimizando..."

# Usar gifsicle diretamente
for gif in $STAGED_GIFS; do
    if [ -f "$gif" ]; then
        ORIG_SIZE=$(stat -f%z "$gif" 2>/dev/null || stat -c%s "$gif" 2>/dev/null || wc -c < "$gif")

        gifsicle -O3 --colors=128 --lossy=30 --loopcount=0 "$gif" -o "$gif.tmp" 2>/dev/null

        if [ $? -eq 0 ]; then
            mv "$gif.tmp" "$gif"
            FINAL_SIZE=$(stat -f%z "$gif" 2>/dev/null || stat -c%s "$gif" 2>/dev/null || wc -c < "$gif")
            echo "  OK $(basename $gif)"
            git add "$gif"
        else
            rm -f "$gif.tmp"
            echo "  SKIP $(basename $gif)"
        fi
    fi
done

exit 0
